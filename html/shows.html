<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
		<title>Raspi DMX Player | Shows</title>
		<link rel="stylesheet" type="text/css" href="../css/main.css" />
		<link rel="preconnect" href="https://fonts.gstatic.com">
		<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
		<script src="https://kit.fontawesome.com/5038d07fd4.js" crossorigin="anonymous"></script>


		<!-- WEBSOCKET SETUP CODE -->
		<script type="text/javascript">
			console.log('open: ');
			var ws = new WebSocket("ws://localhost:8081");
			var showData;

			ws.onopen = function (event) {
			  	console.log('Connection is open ...');
			  	//ws.send("Hello Server. Drew was here");


			  	// UPDATE TO LOAD ALL SHOWS
			  	updateCell("show001.txt");
			};

			ws.onerror = function (err) {
			  console.log('err: ', err);
			}

			ws.onmessage = function (event) {
			  	console.log(event.data);
			  	var message = event.data;

			 	if (message.substring(0, 7) == "getShow") {
	  				showData = message.substring(9, message.length-2);
	  			}
			};

			ws.onclose = function() {
			  console.log("Connection is closed...");
			}


			function renameShow(fileName, oldName) {
				ws.send('getShow(' + fileName + ')');
				console.log("sent getshow request for " + fileName)

				setTimeout(function(){ 
					var newName = prompt("Please enter a new show name", oldName);
					document.getElementById("showNameTableCell-1").innerHTML = newName + ' <button class="Show_ActionButton Show_ActionButton_Right" onclick="renameShow(\'show001.txt\', \'' + newName + '\')"><i class="fas fa-pen"></i></button>';

					var name = showData;
	  				name = name.split(",");
	  				name[0] = 'Name:‚Äù' + newName + '"';
	  				var result = name.join(",");

					ws.send("saveShow[" + fileName + "](" + result + ")");
				}, 100);
			}



			function updateCell(fileName) {
				ws.send('getShow(' + fileName + ')');
				console.log("sent getshow request for " + fileName)

				setTimeout(function(){ 
					var name = showData;
	  				name = name.split(",");
	  				var result = name[0].substring(6, name[0].length-1);

					document.getElementById("showNameTableCell-1").innerHTML = result + ' <button class="Show_ActionButton Show_ActionButton_Right" onclick="renameShow(\'show001.txt\', \'' + result + '\')"><i class="fas fa-pen"></i></button>';
				}, 100);
			}
		</script>
	</head>
	<body class="html-body">
		<div class="header">
		<a href="../index.html" class="logo">Home</a>
			<div class="header-right">
				<a href="../html/shows.html" class="active">Shows</a>
				<a href="../html/scheduler.html">Scheduler</a>
				<a href="../html/dmx-control.html">Channels</a>
				<a href="../html/settings.html">Settings</a>
			</div>
		</div>
		
		<div class="body">
			<h1 class="bold">Shows <button class="Show_ActionButton" onclick="addShow()"><i class="fas fa-plus fa-2x"></i></button></h1>

			<table>
			  <tr>
			    <th>Show Name</th>
			    <th>File Name</th>
			    <th>Actions</th>
			  </tr>
			  <tr>
			    <td id="showNameTableCell-1">RGB Basic <button class="Show_ActionButton Show_ActionButton_Right" onclick="renameShow('show001.txt', 'RGB Basic')"><i class="fas fa-pen"></i></button></td>
			    <td id="fileNameTableCell-1">show001.txt</td>
			    <td id="actionsTableCell-1"><a href="./show-editor.html" class="Show_ActionButton" onclick="editShow('show001.txt')"><i class="fas fa-edit"></i></a><button class="Show_ActionButton redbutton" onclick="deleteShow('show001.txt')"><i class="fas fa-trash-alt"></i></button></td>
			  </tr>

			  <!--
			  <tr>
			    <td>RGB basic <button class="Show_ActionButton Show_ActionButton_Right" onclick="editShow(1)"><i class="fas fa-pen"></i></button></td>
			    <td>show001.txt</td>
			    <td><button class="Show_ActionButton"><i class="fas fa-edit"></i></button><button class="Show_ActionButton redbutton"><i class="fas fa-trash-alt"></i></button></td>
			  </tr>
				-->
			</table>
		</div>


		<script type="text/javascript">
			function editShow(fileName) {
				// websocket let the server know which show we're going to edit so it can serve that show on the next page
				ws.send("nextShowToEdit(" + fileName + ")");
			}


			function deleteShow(fileName) {
				if (confirm("Are you sure you want to delete this show?")) {
					console.log("DELETE SHOW " + fileName);
					// WEBSOCKET DELETE SHOW


					// note to self. considering removing the delete show option, since they could just edit the show to be a new one...
					// furthermore, enforce limit of 20 shows or smt. to make variables managable
				}
			}
		</script>
	</body>
</html>